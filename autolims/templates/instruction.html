{% load run_tags %} 

{% with instruction.operation as operation %}

    {% if operation.op == 'oligosynthesize' %}
    
        <table class="table table-striped" >
         <tbody>
            {% for oligo in operation.oligos %}
                <tr>
                    <td >{% include 'container_link.html' with object=oligo.destination %}</td>
                    <td >        
                        <dl class="dl-horizontal">
                           <dt>Sequence</dt>
                           <dd>{{oligo.sequence}}</dd>
                           <dt>Scale</dt>
                           <dd>{{oligo.scale}}</dd>
                           <dt>Purification</dt>
                           <dd>{{oligo.purification}}</dd>
                        </dl>    
                    </td>
                </tr>
            {% endfor %}
          </tbody>
        </table>  
        
        
        
    {% elif operation.op == 'spin' %}
        
         <dl class="dl-horizontal">
            <dt>Object</dt>
            <dd>{% include 'container_link.html' with object=operation.object %}</dd>
            <dt>Acceleration</dt>
            <dd>{{operation.acceleration}}</dd>
            <dt>Duration</dt>
            <dd>{{operation.duration}}</dd>
            <dt>Flow Direction</dt>
            <dd>{% firstof operation.flow_direction 'inward' %}</dd>
            <dt>Spin Directions</dt>
            <dd>{% firstof operation.spin_direction 'clockwise' %}</dd>
         </dl>    
    
    {% elif operation.op == 'provision' %}
        <dl class="dl-horizontal">
            <dt>Resource</dt>
            <dd>{{operation.resource_id|resource_id_to_name}}</dd>
            <dt>Transfer</dt>
            <dd>
                 <table class="table table-striped" >
                    <tbody>
                       {% for destination_info in operation.to %}
                           <tr>
                               <td>{{destination_info.volume}} to {% include 'container_link.html' with object=destination_info.well %}</td>
                               
                           </tr>
                       {% endfor %}
                     </tbody>
                   </table>              
            
                {% include 'container_link.html' with object=oligo.destination %}            
            
            </dd>
            
        </dl>
        
    {% elif operation.op == 'pipette' %}

     <table class="table table-striped" >
        <tbody>

        {% for pipette_group in operation.groups %}

            {% for pipette_operation_type, pipette_operation_info in pipette_group.items %}

                {% if pipette_operation_type == 'transfer' %}

    
                    {% for transfer_op in pipette_operation_info %}
                    
                        <tr>
                            <td> Transfer {{transfer_op.volume}} from {% include 'container_link.html' with object=transfer_op.from %} to {% include 'container_link.html' with object=transfer_op.to %}</td>
                        </tr>
                    
                    {% endfor %}
                    
                {% elif pipette_operation_type == 'distribute' %}

    
                    {% with distribute_op as pipette_operation_info  %}
                    
                       
                    
                    {% endwith %}
                    
                {% endif %}
                    
            {% endfor %}
        {% endfor %}
              


        
          </tbody>
       </table>       
    
    
    {% endif %}
    
   <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#raw_protocool_div{{instruction.id}}" aria-expanded="false" aria-controls="collapseExample">
    Show/Hide Raw
  </button>
  <br />
  <div class="collapse" id="raw_protocool_div{{instruction.id}}">
    <div class="card card-block">
    <pre id="raw_protocol_{{instruction.id}}">
     </pre>
    </div>
  </div>

<script>

parsedJson{{instruction.id}} = {{operation|format_json|safe}};

document.getElementById('raw_protocol_{{instruction.id}}').innerHTML =
        JSON.stringify(parsedJson{{instruction.id}}, null, '  ');
</script>

{% endwith %}

